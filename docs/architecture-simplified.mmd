%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#FF9900','primaryTextColor':'#fff','primaryBorderColor':'#232F3E','lineColor':'#232F3E','secondaryColor':'#527FFF','tertiaryColor':'#3F8624'}}}%%
flowchart TD
    Start([Trade PDF Upload]) --> S3

    S3[("ğŸ—„ï¸ Amazon S3<br/>otc-menat-2025")] --> Agent1

    Agent1["ğŸ¤– Document Processor<br/>PDF â†’ Images (300 DPI)"] --> Agent2

    Agent2["ğŸ¤– OCR Processor<br/>Image â†’ Text"] --> Bedrock1{{"ğŸ§  AWS Bedrock<br/>Claude Sonnet 4"}}

    Bedrock1 --> Agent3["ğŸ¤– Trade Entity Extractor<br/>Text â†’ JSON"]

    Agent3 --> S3_JSON[("ğŸ“‹ S3: extracted/<br/>trade_data.json")]

    S3_JSON --> Agent4["ğŸ¤– Reporting Analyst<br/>JSON â†’ DynamoDB"]

    Agent4 --> DDB_Tool{{"âš™ï¸ DynamoDB Tool<br/>+ MCP Server"}}

    DDB_Tool --> DDB_Bank[("ğŸ’¾ BankTradeData")]
    DDB_Tool --> DDB_CP[("ğŸ’¾ CounterpartyTradeData")]

    DDB_Bank --> Agent5["ğŸ¤– Matching Analyst<br/>Trade Matching"]
    DDB_CP --> Agent5

    Agent5 --> Report[("ğŸ“Š S3: reports/<br/>matching_report.md")]

    Report --> End([Complete])

    style Start fill:#00A4BD,stroke:#232F3E,color:#fff
    style End fill:#00A4BD,stroke:#232F3E,color:#fff
    style S3 fill:#FF9900,stroke:#232F3E,color:#fff
    style S3_JSON fill:#FF9900,stroke:#232F3E,color:#fff
    style Report fill:#FF9900,stroke:#232F3E,color:#fff
    style Agent1 fill:#00A4BD,stroke:#232F3E,color:#fff
    style Agent2 fill:#00A4BD,stroke:#232F3E,color:#fff
    style Agent3 fill:#00A4BD,stroke:#232F3E,color:#fff
    style Agent4 fill:#00A4BD,stroke:#232F3E,color:#fff
    style Agent5 fill:#00A4BD,stroke:#232F3E,color:#fff
    style Bedrock1 fill:#527FFF,stroke:#232F3E,color:#fff
    style DDB_Tool fill:#DD344C,stroke:#232F3E,color:#fff
    style DDB_Bank fill:#3F8624,stroke:#232F3E,color:#fff
    style DDB_CP fill:#3F8624,stroke:#232F3E,color:#fff
