
document_processing_task:
  description: >
    Convert the PDF document at {document_path} to high-quality images. Create a unique folder in ./pdf_images/ and save all images there.
  expected_output: >
    Each page converted into high-resolution JPEG images saved in a unique folder. Provide the folder path containing the images.
  agent: document_processor


research_task:
  description: >
    **CRITICAL DATA PRESERVATION:** Extract comprehensive trade data from the Images maintaining ALL critical details for accurate matching.
    Document Path: {document_path}
    
    **MANDATORY WORKFLOW:**
    
    1. Extract and preserve ALL the following critical fields (DO NOT SIMPLIFY):
       - Trade_ID/Reference Number/Deal ID
       - Counterparty details (name, LEI code, address, contact info)
       - Trade Date, Settlement Date, Maturity Date
       - Product details (asset class, instrument type, ISIN/CUSIP)
       - Economic terms (notional, price, rate, currency, day count)
       - Payment schedules and frequencies
       - Trade capacity (principal/agent)
       - Regulatory fields (USI, UTI, MiFID flags)
       - Settlement instructions (SSI details, account numbers)
       - Risk and margin information
       - Any additional custom fields specific to the trade type
    3. Structure as comprehensive JSON preserving granular detail
    4. Use FileWriterTool to save complete JSON to ./data/trade_data.json
    
    **DATA QUALITY REQUIREMENTS:**
    - Preserve decimal precision for all amounts
    - Maintain original date formats 
    - Keep all counterparty identifiers
    - Extract complete payment schedules
    - Capture all regulatory flags
    - Retain settlement instruction details
    
   
    **CRITICAL:** Do NOT simplify or summarize data. Preserve rich details essential for trade matching.
    
  expected_output: >
    Confirmation that trade_data.json has been created in ./data/ directory containing:
    - name the file with a unique_identifier so the earlier ones dont get overwritten.
    - Complete trade data with Trade_ID and ALL extracted fields
    - Comprehensive counterparty details including LEI codes
    - Full economic terms with decimal precision
    - Complete payment schedules and settlement instructions
    - All regulatory and compliance fields
    - Message: "Successfully created ./data/trade_data.json with comprehensive trade data"
  agent: researcher

reporting_task:
  description: >
    **TASK FOCUS:** Store comprehensive trade data in TinyDB database with data integrity preservation.
    
    **STRICT WORKFLOW (NO DEVIATIONS):**
    1. Use "Read a file's content" tool to read ./data/trade_data.json (read ONCE only)
    2. Parse the JSON string into a dictionary
    3. Use TradeStorageTool to store the parsed data into TinyDB database
       - If the file path contains "/COUNTERPARTY/", use counterparty_trade_data.db
       - If the file path contains "/BANK/", use bank_trade_data.db
   
    
    **MANDATORY REQUIREMENTS:**
    - Read the file ONCE, parse it, then use TradeStorageTool
    - Preserve ALL data fields from the comprehensive JSON structure
    - Do NOT read the file multiple times
    - Do NOT look for a "status" field - the JSON contains trade data directly
    - Do NOT use PDFExtractorTool or delegate tasks
    - Do NOT provide database optimization advice
    - Do NOT suggest system improvements
   


    **TASK BOUNDARY:** You are ONLY responsible for data storage. Do not provide suggestions 
    about data architecture, system design, or operational improvements.
    
  expected_output: >
    Confirmation of successful storage containing ONLY:
    - "Stored trade [Trade_ID] in counterparty_trade_data.db"
    - "Action: inserted"
    - Database record count
    - NO additional commentary or suggestions
  agent: reporting_analyst

matching_task:
  description: >
    **CRITICAL TRADE MATCHING TASK - APPLY YOUR 20+ YEARS OF EXPERTISE**
    
    You need to match trades between bank_trade_data.db (./storage/bank_trade_data.db) and 
    counterparty_trade_data.db (./storage/counterparty_trade_data.db).
    
    **USE YOUR VETERAN EXPERTISE TO:**
    
    1. **ANALYZE DATA STRUCTURES:**
       - Examine both databases to understand their schemas and field naming conventions
       - Identify which fields map between systems (e.g., "Trade ID" vs "Reference Number")
       - Recognize counterparty-specific formatting patterns you've seen in your 20 years
       - Document any data quality issues or missing critical fields
    
    2. **APPLY PROFESSIONAL MATCHING LOGIC:**
       - Use your knowledge of what constitutes a match vs a break in real trading operations
       - Apply appropriate tolerances based on asset class and field type (you know when 0.01 matters)
       - Recognize rounding differences vs real discrepancies
       - Identify systematic booking problems vs one-off errors
       - Consider T+1 settlement requirements and their impact on matching urgency
    
    3. **PERFORM INTELLIGENT MATCHING:**
       - Match trades using your understanding of critical vs non-critical fields
       - Apply ISDA standards and regional market conventions as appropriate
       - Recognize when seeming differences are actually identical (format variations)
       - Flag true exceptions that need escalation vs false positives
       - Handle each asset class with its specific matching requirements
    
    4. **VALIDATE WITH PROFESSIONAL SKEPTICISM:**
       - A 100% match rate is a RED FLAG - real-world matching NEVER achieves this
       - Question any matching logic that produces unrealistic results
       - Apply the "smell test" - does this match make business sense?
       - Consider counterparty relationships and their typical error patterns
    
    5. **CLASSIFY MATCHES PROFESSIONALLY:**
       Based on your experience, categorize each trade comparison as:
       - MATCHED: All critical fields align within acceptable tolerances
       - PROBABLE MATCH: Minor discrepancies that your experience suggests are not breaks
       - REVIEW REQUIRED: Discrepancies that need human investigation
       - BREAK: Clear mismatch requiring immediate attention
       - DUPLICATE/ERROR: Systematic issues requiring escalation
    
    6. **APPLY CONTEXT AND NUANCE:**
       - Use your knowledge of how Goldman vs JPMorgan vs other counterparties book trades
       - Recognize exotic derivative component matching requirements
       - Understand when to apply strict matching vs intelligent tolerance
       - Identify patterns that indicate upstream system issues
    
    **CRITICAL REQUIREMENTS:**
    - DO NOT blindly match everything - this would be malpractice
    - DO apply the professional skepticism you've developed over 20 years
    - DO recognize that perfect matching is impossible - expect 70-95% match rates
    - DO identify and explain WHY trades don't match, not just that they don't
    - DO prioritize breaks by settlement risk and financial impact
    
  expected_output: >
    **PROFESSIONAL MATCHING REPORT DELIVERABLES:**
    
    1. **EXECUTIVE SUMMARY:**
       - Overall match rate with your professional assessment (is it reasonable?)
       - Key concerns or systematic issues identified
       - Comparison to typical match rates you've seen in your experience
       - Immediate actions required for T+1 settlement
    
    2. **DATABASE UPDATES:**
       Update matching_results.db with your professional judgment:
       - Match determinations with confidence scores
       - Specific reasons for any breaks (using your knowledge of common issues)
       - Risk assessment for unmatched trades
       - Recommended actions based on your experience
    
    3. **DETAILED ANALYSIS REPORT:**
       Save to ./data/{unique_identifier}_matching_report.md:
       - Matched trades with any caveats or conditions
       - Breaks analysis with root cause identification
       - Pattern recognition (are breaks systematic or random?)
       - Counterparty-specific issues you've identified
       - Recommendations based on your 20 years of experience
       - False positives avoided through your expertise
    
    4. **PROFESSIONAL VALIDATION:**
       - Explain WHY your match rate is realistic (not 100%)
       - Identify which counterparties have higher break rates and why
       - Highlight any data quality issues affecting matching
       - Provide confidence assessment in your matching decisions
    
    **YOUR EXPERTISE MATTERS:**
    Use your deep understanding of trade matching to produce a report that a junior analyst 
    couldn't - one that shows the nuance, context, and professional judgment that comes from 
    processing millions of trades. A report that operations managers can trust because it 
    reflects real-world matching, not naive algorithmic comparison.
    
    Message: "Matching report saved to ./data/{unique_identifier}_matching_report.md - 
    Match rate: [X%] (within expected range based on counterparty and data quality)"
    
  agent: matching_analyst